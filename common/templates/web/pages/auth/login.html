{% extends 'web/layout/main.html' %}
{% load staticfiles cf_tags%}
{% block head %}
    <link rel="stylesheet" href="{% static 'web/css/login.css' %}">
{% endblock %}
{% block content %}
  <div class="body-container flex-center">
    <div class="login-box">
      <a href="{% url 'index' %}"><img src="{% static 'web/images/logo.png' %}" alt="logo"></a>
      <div class="login-info-box flex-column alcenter">
        <p class="title">登录</p>
        <p class="sub-title">欢迎来到币家</p>
        <form action="{% url 'login' %}" class="el-form" method="post">
          <div class="el-input">
            <div class="el-label-box">
              <img class="el-icon" src="{% static 'web/images/yonghu-2.png' %}" alt="yonghu" />
            </div>
            {{ login_form.phone }}
            {% if login_form.phone.errors %}
                <div style="color:red; margin-left:8px; margin-top:5px">
                   {{ login_form.phone.errors }}
                </div>
            {% endif %}
          </div>
          {% if login_way == "password" %}
              <div class="el-input">
                <div class="el-label-box">
                  <img class="el-icon" src="{% static 'web/images/mima.png' %}" alt="yonghu" />
                </div>
                {{ login_form.password }}
                {% if login_form.password.errors %}
                    <div style="color:red; margin-left:8px; margin-top:5px">
                       {{ login_form.password.errors }}
                    </div>
                {% endif %}
                <div class="el-input-right">
                  <img class="el-icon" src="{% static 'web/images/yanjing.png' %}" alt="yanjing" />
                </div>
              </div>
          {% endif %}
          {% if login_way == "verify" %}
              <div class="el-input">
                <div class="el-label-box">
                  <img class="el-icon" src="{% static 'web/images/mima.png' %}" alt="yonghu" />
                </div>
                {{ login_form.v_code }}
                {% if login_form.v_code.errors %}
                    <div style="color:red; margin-left:8px; margin-top:5px">
                       {{ login_form.v_code.errors }}
                    </div>
                {% endif %}
                <div class="el-input-right">
                  <div onclick="GetCodeRister(this)" class="el-button mini">发送</div>
                </div>
              </div>
          {% endif %}
          <div class="btn-box flex-between">
            {% if login_way == "password" %}
                <a href="{% url 'login' %}?login_way=verify">验证码登录</a>
            {% endif %}
             {% if login_way == "verify" %}
                <a href="{% url 'login' %}?login_way=password">密码登陆</a>
            {% endif %}
            <a href="{% url 'forget' %}">忘记密码？</a>
          </div>
          <button type="submit" class="el-button block">登录</button>
        </form>
        <p class="register-box">你还没有账号？<a href="{% url 'register' %}">注册</a></p>
      </div>
    </div>
  </div>
  <script>
    function GetCodeRister(obj) {
        let phone = $("input[name='phone']").val();
        console.log("phone = ", phone)
        if (phone.length !== 11) {
            alert('手机号长度不够');
            return 0;
        }
        let url = window.location.href;
        var index = url.lastIndexOf("\/");
        var url_str = url.substring(0, index + 1);
        let req_url = url_str + 'sms_send?phone=' + phone;
        console.log(req_url)
        $.ajax({
            url: req_url,
            type: "GET",
            dataType: "json",
            success: function (result) {
                if(result.code === 200){
                    msg = JSON.parse(result.result)
                    if (msg.Code === 'OK') {
                        alert("获取验证码成功");
                    } else {
                        alert("获取验证码失败，请检查手机号之后重新获取");
                    }
                }
            }
        });
    }
  </script>
{% endblock %}